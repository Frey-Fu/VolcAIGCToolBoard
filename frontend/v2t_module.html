<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è§†é¢‘ç†è§£åŠŸèƒ½</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 20px; }
        .container { max-width: 700px; margin: 0 auto; background: white; border-radius: 12px; box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1); overflow: hidden; }
        .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px; text-align: center; }
        .header h1 { font-size: 24px; margin-bottom: 8px; }
        .header p { opacity: 0.9; font-size: 14px; }
        .form-section { padding: 30px; }
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; margin-bottom: 8px; font-weight: 600; color: #333; font-size: 14px; }
        .form-group input, .form-group textarea { width: 100%; padding: 12px; border: 1px solid #e0e0e0; border-radius: 8px; font-size: 14px; transition: border-color 0.3s; }
        .form-group input:focus, .form-group textarea:focus { outline: none; border-color: #667eea; }
        .form-group textarea { resize: vertical; min-height: 120px; }
        .upload-area { border: 2px dashed #667eea; border-radius: 8px; padding: 30px; text-align: center; cursor: pointer; transition: all 0.3s; margin-bottom: 15px; }
        .upload-area:hover { border-color: #5a6fd8; background-color: #f8f9ff; }
        .upload-area.dragover { border-color: #4caf50; background-color: #f1f8e9; }
        .upload-icon { font-size: 48px; color: #667eea; margin-bottom: 10px; }
        .upload-text { color: #666; font-size: 14px; line-height: 1.5; }
        .file-input { display: none; }
        .video-preview { margin-top: 15px; display: none; }
        .video-preview video { width: 100%; max-height: 300px; border-radius: 8px; border: 1px solid #e0e0e0; }
        .video-info { margin-top: 10px; padding: 10px; background: #f8f9fa; border-radius: 6px; font-size: 12px; color: #666; }
        .remove-video { margin-top: 10px; padding: 6px 12px; background: #dc3545; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 12px; }
        .remove-video:hover { background: #c82333; }
        .submit-btn { width: 100%; padding: 15px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 8px; font-size: 16px; font-weight: 600; cursor: pointer; transition: all 0.3s; }
        .submit-btn:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3); }
        .submit-btn:disabled { background: #ccc; cursor: not-allowed; transform: none; box-shadow: none; }
        .loading { display: none; text-align: center; padding: 20px; }
        .loading-spinner { width: 40px; height: 40px; border: 4px solid #f3f3f3; border-top: 4px solid #667eea; border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 15px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .result-section { display: none; margin-top: 20px; padding: 20px; background: #f8f9fa; border-radius: 8px; border-left: 4px solid #667eea; }
        .result-title { font-weight: 600; color: #333; margin-bottom: 10px; }
        .result-content { color: #555; line-height: 1.6; white-space: pre-wrap; }
        .error-message { display: none; margin-top: 15px; padding: 12px; background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; border-radius: 6px; font-size: 14px; }
        .success-message { display: none; margin-top: 15px; padding: 12px; background: #d4edda; color: #155724; border: 1px solid #c3e6cb; border-radius: 6px; font-size: 14px; }
        .file-size-info { font-size: 12px; color: #666; margin-top: 5px; }
        .fps-slider { width: 100%; height: 6px; border-radius: 3px; background: #e0e0e0; outline: none; -webkit-appearance: none; margin: 10px 0; }
        .fps-slider::-webkit-slider-thumb { -webkit-appearance: none; appearance: none; width: 20px; height: 20px; border-radius: 50%; background: #667eea; cursor: pointer; box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2); }
        .fps-slider::-moz-range-thumb { width: 20px; height: 20px; border-radius: 50%; background: #667eea; cursor: pointer; border: none; box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2); }
        .fps-info { font-size: 12px; color: #666; margin-top: 5px; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header"><h1>ğŸ¬ è§†é¢‘ç†è§£</h1><p>ä¸Šä¼ è§†é¢‘æ–‡ä»¶ï¼ŒAIå°†æ ¹æ®æ‚¨çš„æç¤ºè¯åˆ†æè§†é¢‘å†…å®¹å¹¶ç”Ÿæˆç›¸åº”æ–‡æ¡ˆ</p></div>
        <div class="form-section"><form id="videoComprehensionForm"><div class="form-group"><label for="apiKey">API Key</label><input type="password" id="apiKey" name="apiKey" placeholder="è¯·è¾“å…¥æ‚¨çš„API Key"></div><div class="form-group"><label for="prompt">æç¤ºè¯</label><textarea id="prompt" name="prompt" placeholder="è¯·è¾“å…¥æ‚¨å¸Œæœ›AIå¦‚ä½•åˆ†æè¿™ä¸ªè§†é¢‘çš„æç¤ºè¯"></textarea></div><div class="form-group"><label for="fps">æŠ½å¸§é¢‘ç‡ (FPS): <span id="fpsValue">1.0</span></label><input type="range" id="fps" name="fps" min="0.2" max="5" step="0.1" value="1.0" class="fps-slider"><div class="fps-info">è°ƒæ•´è§†é¢‘åˆ†ææ—¶çš„æŠ½å¸§é¢‘ç‡ï¼Œæ•°å€¼è¶Šé«˜åˆ†æè¶Šç²¾ç»†</div></div><div class="form-group"><label>è§†é¢‘æ–‡ä»¶</label><div class="upload-area" id="uploadArea"><div class="upload-icon">ğŸ¥</div><div class="upload-text">ç‚¹å‡»é€‰æ‹©è§†é¢‘æ–‡ä»¶æˆ–æ‹–æ‹½æ–‡ä»¶åˆ°æ­¤å¤„<br>æ”¯æŒ MP4, AVI, MOV ç­‰æ ¼å¼ï¼Œå•è§†é¢‘æœ€å¤§50MB</div></div><input type="file" id="videoFile" class="file-input" accept="video/*"><div class="file-size-info">å»ºè®®ä¸Šä¼ æ—¶é•¿ä¸è¶…è¿‡5åˆ†é’Ÿçš„è§†é¢‘æ–‡ä»¶</div><div class="video-preview" id="videoPreview"><video id="previewVideo" controls></video><div class="video-info" id="videoInfo"></div><button type="button" class="remove-video" id="removeVideo">ç§»é™¤è§†é¢‘</button></div></div><button type="submit" class="submit-btn" id="submitBtn">å¼€å§‹åˆ†æè§†é¢‘</button><div class="loading" id="loading"><div class="loading-spinner"></div><div>æ­£åœ¨åˆ†æè§†é¢‘å†…å®¹ï¼Œè¯·ç¨å€™...</div></div><div class="error-message" id="errorMessage"></div><div class="success-message" id="successMessage"></div><div class="result-section" id="errorDisplay" style="display:none;"><div class="result-title">é”™è¯¯ä¿¡æ¯ï¼š</div><div class="result-content" id="result-content"></div></div><div class="result-section" id="resultSection"><div class="result-title">åˆ†æç»“æœï¼š</div><div class="result-content" id="resultContent"></div></div></form></div>
    </div>
    <script src="./static/error_utils.js"></script>
    <script>
        let selectedVideo = null; let videoUrl = null;
        const uploadArea = document.getElementById('uploadArea'); const videoFile = document.getElementById('videoFile'); const videoPreview = document.getElementById('videoPreview'); const previewVideo = document.getElementById('previewVideo'); const videoInfo = document.getElementById('videoInfo'); const removeVideo = document.getElementById('removeVideo'); const form = document.getElementById('videoComprehensionForm'); const submitBtn = document.getElementById('submitBtn'); const loading = document.getElementById('loading'); const errorMessage = document.getElementById('errorMessage'); const successMessage = document.getElementById('successMessage'); const resultSection = document.getElementById('resultSection'); const resultContent = document.getElementById('resultContent'); const fpsSlider = document.getElementById('fps'); const fpsValue = document.getElementById('fpsValue');
        fpsSlider.addEventListener('input', (e) => { fpsValue.textContent = parseFloat(e.target.value).toFixed(1); });
        uploadArea.addEventListener('click', () => { videoFile.click(); }); videoFile.addEventListener('change', handleFileSelect);
        uploadArea.addEventListener('dragover', (e) => { e.preventDefault(); uploadArea.classList.add('dragover'); }); uploadArea.addEventListener('dragleave', () => { uploadArea.classList.remove('dragover'); }); uploadArea.addEventListener('drop', (e) => { e.preventDefault(); uploadArea.classList.remove('dragover'); const files = e.dataTransfer.files; if (files.length > 0) { handleFile(files[0]); } });
        removeVideo.addEventListener('click', () => { selectedVideo = null; videoUrl = null; videoFile.value = ''; videoPreview.style.display = 'none'; previewVideo.src = ''; });
        function handleFileSelect(e) { const file = e.target.files[0]; if (file) { handleFile(file); } }
        function handleFile(file) { if (!file.type.startsWith('video/')) { showError('è¯·é€‰æ‹©è§†é¢‘æ–‡ä»¶'); return; } const maxSize = 100 * 1024 * 1024; if (file.size > maxSize) { showError('æ–‡ä»¶å¤§å°ä¸èƒ½è¶…è¿‡100MB'); return; } selectedVideo = file; const url = URL.createObjectURL(file); previewVideo.src = url; videoPreview.style.display = 'block'; const sizeInMB = (file.size / (1024 * 1024)).toFixed(2); videoInfo.textContent = `æ–‡ä»¶å: ${file.name} | å¤§å°: ${sizeInMB}MB`; hideMessages(); }
        form.addEventListener('submit', async (e) => { e.preventDefault(); const apiKey = document.getElementById('apiKey').value.trim(); const prompt = document.getElementById('prompt').value.trim(); const fps = parseFloat(document.getElementById('fps').value); if (!apiKey) { showError('è¯·è¾“å…¥API Key'); return; } if (!prompt) { showError('è¯·è¾“å…¥æç¤ºè¯'); return; } if (!selectedVideo) { showError('è¯·é€‰æ‹©è§†é¢‘æ–‡ä»¶'); return; } try { showLoading(true); hideMessages(); const uploadResult = await uploadVideo(selectedVideo); if (!uploadResult.success) { throw new Error(uploadResult.error || 'è§†é¢‘ä¸Šä¼ å¤±è´¥'); } videoUrl = uploadResult.url; if (!videoUrl) { throw new Error('è§†é¢‘ä¸Šä¼ æˆåŠŸä½†æœªè·å¾—æœ‰æ•ˆçš„URL'); } const analysisResult = await analyzeVideo(apiKey, videoUrl, prompt, fps); if (!analysisResult.success) { throw new Error(analysisResult.error || 'è§†é¢‘åˆ†æå¤±è´¥'); } showResult(analysisResult.result); showSuccess('è§†é¢‘åˆ†æå®Œæˆï¼'); } catch (error) { console.error('Error:', error); showError(error.message); } finally { showLoading(false); } });
        async function uploadVideo(file) { const formData = new FormData(); formData.append('video', file); const response = await fetch('/upload_video', { method: 'POST', body: formData }); const text = await response.text(); let data = null; try { data = JSON.parse(text); } catch (_) {} if (!response.ok || (data && data.success === false)) { const upstreamInfo = window.ErrorUtils.extractUpstream(data || {}, text); window.ErrorUtils.renderError('result-content', 'è§†é¢‘ä¸Šä¼ å¤±è´¥', `HTTP ${response.status}`, upstreamInfo); document.getElementById('errorDisplay').style.display = 'block'; throw new Error((data && (data.error || data.message)) || `HTTP ${response.status}`); } return data; }
        async function analyzeVideo(apiKey, videoUrl, prompt, fps) { const response = await fetch('/video_comprehension_gen_text', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ api_key: apiKey, video_url: videoUrl, prompt: prompt, fps: fps }) }); const text = await response.text(); let data = null; try { data = JSON.parse(text); } catch (_) {} if (!response.ok || (data && data.success === false)) { const upstreamInfo = window.ErrorUtils.extractUpstream(data || {}, text); window.ErrorUtils.renderError('result-content', 'è§†é¢‘åˆ†æå¤±è´¥', `HTTP ${response.status}`, upstreamInfo); document.getElementById('errorDisplay').style.display = 'block'; } return data || { success: false, error: 'å“åº”è§£æå¤±è´¥' }; }
        function showLoading(show) { loading.style.display = show ? 'block' : 'none'; submitBtn.disabled = show; submitBtn.textContent = show ? 'åˆ†æä¸­...' : 'å¼€å§‹åˆ†æè§†é¢‘'; }
        function showResult(result) { resultContent.textContent = result; resultSection.style.display = 'block'; }
        function showError(message) { errorMessage.textContent = message; errorMessage.style.display = 'block'; successMessage.style.display = 'none'; }
        function showSuccess(message) { successMessage.textContent = message; successMessage.style.display = 'block'; errorMessage.style.display = 'none'; }
        function hideMessages() { errorMessage.style.display = 'none'; successMessage.style.display = 'none'; }
    </script>
</body>
</html>